<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello Fetch</title>
</head>
<body>
<button id="helloBtn">Say Hello</button>

<output></output>

<!--
  - CORS set up
  - using the right headers
  - TODO: encoding and decoding URI formats, parseJSON and JSON.stringify
  - using async/await vs promises VS traditional callbacks
  - same lack of network smarts - errors, timeouts, etc.
-->
<script type="module">
    window.addEventListener('DOMContentLoaded', init);

    function init() {
        let el;

        el = document.getElementById('helloBtn').addEventListener('click', sayHello);
    }

    async function sayHello() {

        let response = await fetch('http://localhost:3000/echo', {
            method: 'POST',
            mode: 'cors',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-Sent-By': 'javascript'
            },
            body: encodeURIComponent(`message=hello there! @ ${new Date()})`)
        });

        if (response.ok) {
            let responseText = await response.text();
            document.querySelector('output').innerHTML = responseText;
        } else {
            alert(`Error : ${response.status}`)
        }


    }
</script>
</body>
</html>